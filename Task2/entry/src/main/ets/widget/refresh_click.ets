@Component
export struct RefreshComponent {
  @BuilderParam
  itemLayout?: (item: Object, index: number) => void; // åˆ—è¡¨é¡¹å¸ƒå±€å‡½æ•°
  @Watch("notifyRefreshingChanged")
  @Link refreshing: boolean; // åˆ·æ–°çŠ¶æ€
  @Link dataSet: Array<Object> // æ•°æ®é›†
  onRefresh?: () => void; // åˆ·æ–°æ—¶çš„å›è°ƒå‡½æ•°
  onStatusChanged?: (status: RefreshStatus) => void; // çŠ¶æ€æ”¹å˜æ—¶çš„å›è°ƒå‡½æ•°
  @Prop private title: string = 'ç‚¹å‡»åˆ·æ–°';   // åˆ·æ–°æŒ‰é’®æ ‡é¢˜
  private refreshStatus: RefreshStatus = RefreshStatus.Inactive; // åˆ·æ–°çŠ¶æ€
  private listScroller: Scroller = new Scroller(); // åˆ—è¡¨æ»šåŠ¨å™¨

  private notifyRefreshingChanged() {
    if (this.refreshing) {
      this.showRefreshingStatus(); // æ˜¾ç¤ºæ­£åœ¨åˆ·æ–°çš„çŠ¶æ€
    } else {
      this.finishRefresh(); // å®Œæˆåˆ·æ–°
    }
  }
//æ„å»ºåˆ·æ–°æŒ‰é’®
  @Builder RefreshBUTTON() {
    Row() {
      if (this.refreshing) {
        Text('ğŸ”„').fontSize(20).margin({ right: 10 });        // åŠ è½½åŠ¨ç”»
      }
      Text(this.refreshing ? 'æ­£åœ¨åˆ·æ–°...' : this.title)        //æ˜¾ç¤ºæ­£åœ¨åˆ·æ–°...
        .fontSize(20)                                         //å­—ä½“å¤§å°ä¸º20
        .textAlign(TextAlign.Center)                          //æ–‡æœ¬å±…ä¸­å¯¹é½
        .backgroundColor('#cccccc')                           //æŒ‰é’®èƒŒæ™¯é¢œè‰²ä¸ºç™½è‰²
        .borderRadius(10)                                     //æŒ‰é’®åœ†è§’åŠå¾„ä¸º10
        .padding({ top: 10, bottom: 10, left: 20, right: 20 })//è®¾ç½®æŒ‰é’®å†…è¾¹è·
        .onClick(() => {                                      //ç»‘å®šç‚¹å‡»äº‹ä»¶
          this.setRefreshStatus(RefreshStatus.Refresh);
          this.notifyRefreshStart();
        });
    }
  }
//æ„å»ºç»„ä»¶çš„ä¸»è¦å¸ƒå±€
  build() {
    Column() {
      this.RefreshBUTTON()    //æ·»åŠ åˆ·æ–°æŒ‰é’®
      Column() {
        List({scroller: this.listScroller}) { // åˆ›å»ºåˆ—è¡¨
          if (this.dataSet) { // å¦‚æœæ•°æ®é›†å­˜åœ¨
            ForEach(this.dataSet, (item: Object, index: number) => { // éå†æ•°æ®é›†
              ListItem() {
                if (this.itemLayout) { // å¦‚æœæœ‰é¡¹å¸ƒå±€å‡½æ•°
                  this.itemLayout(item, index) // è°ƒç”¨é¡¹å¸ƒå±€å‡½æ•°
                }
              }
              .width("100%") // æ¯ä¸ªåˆ—è¡¨é¡¹å®½åº¦å æ»¡100%
            }, (item: Object, index: number) => item.toString()) // åˆ—è¡¨é¡¹çš„å”¯ä¸€æ ‡è¯†
          }
        }
        .width("100%") // åˆ—è¡¨å®½åº¦å æ»¡100%
        .height("100%") // åˆ—è¡¨é«˜åº¦å æ»¡100%
        .edgeEffect(EdgeEffect.None) // æ— è¾¹ç¼˜æ•ˆæœ
        .id('screen')
      }
      .width("100%") // å†…éƒ¨åˆ—å®½åº¦å æ»¡100%
      .layoutWeight(1) // ä½¿ç”¨å¸ƒå±€æƒé‡
      .backgroundColor(Color.White) // èƒŒæ™¯é¢œè‰²
    }
    .width("100%") // å¤–å±‚åˆ—å®½åº¦å æ»¡100%
    .height("100%") // å¤–å±‚åˆ—é«˜åº¦å æ»¡100%
  }
  // ç»„ä»¶å³å°†å‡ºç°æ—¶è°ƒç”¨
  aboutToAppear() {
    if (this.refreshing) {
      this.showRefreshingStatus(); // å¦‚æœæ­£åœ¨åˆ·æ–°ï¼Œæ˜¾ç¤ºåˆ·æ–°çŠ¶æ€
    }
  }
  // æ˜¾ç¤ºæ­£åœ¨åˆ·æ–°çš„çŠ¶æ€
  private showRefreshingStatus() {
    this.setRefreshStatus(RefreshStatus.Refresh); // è®¾ç½®åˆ·æ–°çŠ¶æ€ä¸ºæ­£åœ¨åˆ·æ–°
  }
  // è®¾ç½®åˆ·æ–°çŠ¶æ€
  private setRefreshStatus(status: RefreshStatus) {
    this.refreshStatus = status; // æ›´æ–°åˆ·æ–°çŠ¶æ€
    this.refreshing = (status == RefreshStatus.Refresh); // æ›´æ–°æ˜¯å¦æ­£åœ¨åˆ·æ–°
    this.notifyStatusChanged(); // é€šçŸ¥çŠ¶æ€æ”¹å˜
  }
  // é€šçŸ¥çŠ¶æ€æ”¹å˜
  private notifyStatusChanged() {
    if (this.onStatusChanged) {
      this.onStatusChanged(this.refreshStatus); // è°ƒç”¨çŠ¶æ€æ”¹å˜å›è°ƒå‡½æ•°
    }
  }
  // é€šçŸ¥åˆ·æ–°å¼€å§‹
  private notifyRefreshStart() {
    if (this.onRefresh) {
      this.onRefresh(); // è°ƒç”¨åˆ·æ–°å›è°ƒå‡½æ•°
    }
  }
  // å®Œæˆåˆ·æ–°
  private finishRefresh(): void {
    this.setRefreshStatus(RefreshStatus.Done); // è®¾ç½®åˆ·æ–°çŠ¶æ€ä¸ºå®Œæˆ
    setTimeout(() => { // å»¶è¿Ÿ1500æ¯«ç§’
    }, 1500);
  }



  private resetRefreshStatus() {
    this.setRefreshStatus(RefreshStatus.Inactive); // è®¾ç½®åˆ·æ–°çŠ¶æ€ä¸ºä¸æ´»åŠ¨
  }

}